## IP

---

- 역할
  - 지정한 IP 주소에 데이터 전달
  - 패킷이라는 통신 단위로 데이터를 전달
- 한계
  - 비연결성 (대상 서버가 작동하는지 안하는지 알 수 없음)
  - 비신뢰성 (패킷 소실? 순서 ?)
  - 프로그램 구분 (같은 IP에 어플리케이션이 2개이상이라면 ??)

## 인터넷 프로토콜 스택의 4계층

---

- 애플리케이션 계층 - HTTP, FTP
- 전송 계층 - TCP, UDP
- 인터넷 계층 - IP
- 네트워크 인터페이스 계층

## TCP (Transmission Control Protocol)

---

- 연결지향 - 3 way handshake (물리적으로 연결하는게 아닌 가상으로 연결)
  1. SYN(접속 요청) 전송
  2. SYN + ACK(접속 수락) 전송
  3. ACK 전송
  4. 데이터 전송
- 데이터 전달 보증
- 순서 보장
- 신뢰할 수 있는 프로토콜

## UDP (User Datagram Protocol)

---

- IP와 같음
- IP에서 PORT 추가한 것
- 애플리케이션에서 추가 작업(커스텀마이징)이 필요

## URI (Uniform Resource Identifier)

---

- URI는 URL, URN 또는 둘다 추가로 분류될 수 있다.
- URL
  - 리소스가 있는 위치를 지정
- URN
  - 리소스에 이름을 부여
- 위치는 변할 수 있지만, 이름은 변하지 않음

## 웹 브라우저 요청 흐름

---

1. DNS 조회
2. HTTP 요청 메시지 생성
3. 소켓 라이브러리를 통해 전달
4. TCP/IP 패킷 생성, HTTP 메시지 포함

## HTTP

---

- 클라이언트 서버 구조
  - Request, Response 구조
  - 클라이언트는 서버에 요청을 보내고, 응답 대기
  - 서버가 요청에 대한 결과를 만들어서 응답
- 무상태(Stateless) 프로토콜
- HTTP 메시지에 모든 것을 전송
- 단순함, 확장 가능

## HTTP 메서드

---

### 주요 메서드

- GET : 리소스 조회
  - 전달하고 싶은 데이터는 쿼리 스트링을 통해서 전달
- POST : 요청 데이터 처리, 등록
  - 메시지 바디를 통해 서버로 요청 데이터 전달
- PUT : 리소스 대체, 해당 리소스가 없으면 생성
  - 클라이언트가 리소스를 식별해야 함.
- PATCH : 리소스 부분 수정
- DELETE : 리소스 삭제

### 기타 메서드

- HEAD : GET과 동일하지만 메시지 부분을 제외하고, 상태 줄과 헤더만 반환
- OPTIONS : 대상 리소스에 대한 통신 가능 옵션(메서드)을 설명
- CENNECT : 대상 자원으로 식별되는 서버에 대한 터널을 설정
- TRACE : 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

### HTTP 메서드의 속성

- 안전 (Safe Methods)
  - 호출해도 리소스를 변경하지 않음
  - 해당 리소스만 고려 (계속 호출해서 로그가 쌓여서 장애 발생은 고려하지 않음)
- 멱등 (Idempotent Methods)
  - 호출을 몇번을하든 결과가 동일
  - 외부 요인으로 중간에 리소스가 변경되는 것 까지는 고려하지는 않음
- 캐시가능 (Cacheable Methods)
  - GET, HEAD 정도만 캐시로 사용

## HTTP 상태 코드

---

- 1xx : 요청이 수신되어 처리중
  - 거의 사용하지 않음
- 2xx : 요청 정상 처리
  - 200 : OK
  - 201 : Created
- 3xx : 요청을 완료하려면 추가 행동 필요 (리다이렉션)
  - 영구 리다이렉션
    - 301 : 리다이렉트시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음
    - 308 : 301과 기능은 같음. 리다이렉트시 요청 메서드와 본문 유지
  - 일시 리다이렉션
    - 302 : 리다이렉트 메서드가 GET으로 변하고, 본문이 제거될 수 있음
    - 307 : 302 기능 같음. 리다이렉트시 요청 메서드와 본문 유지
    - 303 : 302 동일, 리다이렉트시 요청 메서드가 GET으로 변경
    - PRG (Post/Redirect/Get)
      - PRG 이후 리다이렉트
        - POST -> GET으로 리다이렉트
        - 새로고침을 해도 GET으로 결과 화면만 조회
  - 특수 리다이렉션
    - 304 : 캐시목적으로 사용
      - 304 응답은 응답에 메시지 바디를 포함하면 안됨
- 4xx : 클라이언트 오류
  - 400 : 클라이언트가 잘못된 요청
  - 401 : 로그인 X
  - 403 : 권한 X
  - 404 : 요청 리소스 찾을 수 없음
- 5xx : 서버 오류

## TTTP 헤더

---

- 일반 정보

  - From : 유저 에이전트의 이메일 정보
  - Referer : 이전 웹 페이지 주소
  - User-Agent : 유저 에이전트 애플리케이션 정보
  - Server : 요청을 처리하는 오리진 서버의 소프트웨어 정보
  - Date : 메시지가 생성된 날짜

- 특별 정보
  - Host : 요청한 호스트 정보(도메인)
  - Location : 페이지 리다이렉션
    - 응답코드 3xx
  - Allow : 허용 가능한 HTTP 메서드
  - Retry-After : 유저 에이전트가 다음 요청을 하기까지 기다려야 하는 시간

## 쿠키

---

- Set-Cookie : 서버에서 클라이언트로 쿠키 전달
- Cookie : 클라이언트가 서버에서 받은 쿠키를 저장하고, HTTP 요청 시 서버로 전달
  - 최소한의 정보만 사용 (세션 ID, 인증 토큰)
  - 서버에 전송하지 않고, 웹브라우저 내부에서 데이터를 저장하고 싶으면 localStoraage, sessionStorage 사용
  - 보안에 민감한 데이터 저장 X
- 도메인

  - 명시 : 명시한 문서기준 도메인 + 서브 도메인 포함
  - 생략 : 현재 문서 기준 도메인만 적용

- 경로 : 보통 /루트로 지정

- 보안
  - Secure
    - Secure 적용시 https인 경우에만 전송
  - HttpOnly
    - XSS 공격방지
    - 자바스크립트에서 접근 불가
    - HTTP 전송에만 사용
  - SameSite
    - 요청 도메인과 쿠키에 설정된 도메인이 같은 경우만 쿠키 전송

## 캐시

---

> 캐시가 없을 때
>
> - 데이터가 변경되지 안항도 네트워크를 통해서 데이터를 계속 다운받아야 함.
> - 인터넷 네트워크는 매우 느리고 비싸다
> - 브라우저 로딩 속도가 느리다
> - 느린 사용자 경험
>
> 캐시 적용
>
> - 캐시 덕분에 캐시 가능 시간동안 네트워크를 사용하지 않음
> - 비싼 네트워크 사용량을 줄일 수 있다
> - 브라우저 로딩 속도가 빠르다
> - 빠른 사용자 경험

- 캐시 검증 헤더와 조건부 요청 1

  - Last-Modified : 수정일
  - 수정일이 초과시 클라이언트가 다시 요청을 보낼 때 if-modified-since 헤더에 마지막 수정일을 확인해 변경된게 없으면 304를 내보냄
  - 클라이언트는 캐시에 저장되어 있는 데이터 재활용 가능
  - 단점
    - 1초 미만 단위로 캐시 조정 불가
    - 날짜 기반의 로직 사용
    - 데이터를 수정해서 날짜가 다르지만, 같은 데이터를 수정해서 데이터 결과가 똑같은 경우
    - 서버에서 별도의 캐시 로직을 관리하고 싶은 경우

- 캐시 검증 헤더와 조건부 2
  - ETag, If-None-Match
    - 캐시용 데이터에 임의의 고유한 버전 이름을 달아둠
    - 데이터가 변경되면 이 이름을 바꾸어서 변경
    - 진짜 단순하게 Etag만 보내서 같으면 유지, 다르면 다시 받기

## 캐시 제어 헤더

---

- Cache-Control: 캐시 제어
  - max-age
    - 캐시 유효 시간, 초 단위
  - no-cache
    - 데이터는 캐시해도 되지만, 항상 origin 서버에 검증하고 사용
  - no-store
    - 데이터에 민감한 정보가 있으면 저장X
- Pragma: 캐시 제어(하위 호환)
  - no-cache
- Expires: 캐시 유효 기간(하위 호환
  - 캐시 만료일 지정
  - Cache-Control: max-age 권장
  - Cache-Control: max-age와 함께 사용하면 Expires는 무시

## 검증 헤더와 조건부 요청 헤더

---

- 검증 헤더
  - ETag (고유 버전의 이름)
  - Last-Modified (날짜)
- 조건부 요청 헤더
  - If-Match, If-None-Match: ETag 값 사용
  - If-Modified-Since, If-Unmodified-Since: Last-Modified 값 사용
